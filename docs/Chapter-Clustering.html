<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Ionome analysis | Assessment of the nutritional imbalance status of potato crop</title>
  <meta name="description" content="I use the bookdown package to write a book that describs the statistical computations of my PhD Project, for publication on Github. The output format choosed is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Ionome analysis | Assessment of the nutritional imbalance status of potato crop" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="I use the bookdown package to write a book that describs the statistical computations of my PhD Project, for publication on Github. The output format choosed is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Ionome analysis | Assessment of the nutritional imbalance status of potato crop" />
  
  <meta name="twitter:description" content="I use the bookdown package to write a book that describs the statistical computations of my PhD Project, for publication on Github. The output format choosed is bookdown::gitbook." />
  

<meta name="author" content="Zonlehoua Coulibali and Serge-Étienne Parent" />


<meta name="date" content="2019-07-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html">
<link rel="next" href="Chapter-Modeling.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Data processing</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#useful-libraries-for-data-handling"><i class="fa fa-check"></i><b>1.2</b> Useful libraries for data handling</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#quebec-potato-data-set"><i class="fa fa-check"></i><b>1.3</b> Québec potato data set</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#selection-of-useful-variables"><i class="fa fa-check"></i><b>1.4</b> Selection of useful variables</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#arranging-the-data-frame"><i class="fa fa-check"></i><b>1.5</b> Arranging the data frame</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#cultivar-classes-correction"><i class="fa fa-check"></i><b>1.6</b> Cultivar classes correction</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#summarise-and-backup"><i class="fa fa-check"></i><b>1.7</b> Summarise and backup</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html"><i class="fa fa-check"></i><b>2</b> Ionome analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#objective-1"><i class="fa fa-check"></i><b>2.1</b> Objective</a></li>
<li class="chapter" data-level="2.2" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#useful-libraries-and-custom-functions"><i class="fa fa-check"></i><b>2.2</b> Useful libraries and custom functions</a></li>
<li class="chapter" data-level="2.3" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#leaves-processed-compositions-data-set"><i class="fa fa-check"></i><b>2.3</b> Leaves processed compositions data set</a></li>
<li class="chapter" data-level="2.4" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#the-yield-cut-off-low-and-high-yielders-delimiter"><i class="fa fa-check"></i><b>2.4</b> The yield cut-off, low and high yielders delimiter</a></li>
<li class="chapter" data-level="2.5" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#centered-log-ratio-clr-centroids-computation"><i class="fa fa-check"></i><b>2.5</b> Centered log-ratio (clr) centroids computation</a></li>
<li class="chapter" data-level="2.6" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#clustering-potato-cultivars-with-ionome"><i class="fa fa-check"></i><b>2.6</b> Clustering potato cultivars with ionome</a></li>
<li class="chapter" data-level="2.7" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#axis-reduction"><i class="fa fa-check"></i><b>2.7</b> Axis reduction</a></li>
<li class="chapter" data-level="2.8" data-path="Chapter-Clustering.html"><a href="Chapter-Clustering.html#do-clrs-affect-potato-tuber-yield"><i class="fa fa-check"></i><b>2.8</b> Do clrs affect potato tuber yield?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html"><i class="fa fa-check"></i><b>3</b> Predicting tuber yield category</a><ul>
<li class="chapter" data-level="3.1" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#objective-2"><i class="fa fa-check"></i><b>3.1</b> Objective</a></li>
<li class="chapter" data-level="3.2" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#useful-libraries"><i class="fa fa-check"></i><b>3.2</b> Useful libraries</a></li>
<li class="chapter" data-level="3.3" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#machine-learning-data-set"><i class="fa fa-check"></i><b>3.3</b> Machine learning data set</a></li>
<li class="chapter" data-level="3.4" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#machine-learning"><i class="fa fa-check"></i><b>3.4</b> Machine learning</a><ul>
<li class="chapter" data-level="3.4.1" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#data-train-and-test-splits"><i class="fa fa-check"></i><b>3.4.1</b> Data train and test splits</a></li>
<li class="chapter" data-level="3.4.2" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#building-the-models"><i class="fa fa-check"></i><b>3.4.2</b> Building the Models</a></li>
<li class="chapter" data-level="3.4.3" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#goodness-of-fit-on-training-set"><i class="fa fa-check"></i><b>3.4.3</b> Goodness of fit on training set</a></li>
<li class="chapter" data-level="3.4.4" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#models-evaluation-test-set"><i class="fa fa-check"></i><b>3.4.4</b> Models’ evaluation (test set)</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#estimate-variable-importance"><i class="fa fa-check"></i><b>3.5</b> Estimate variable importance</a></li>
<li class="chapter" data-level="3.6" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#make-predictions-on-the-test-data-with-rf-model"><i class="fa fa-check"></i><b>3.6</b> Make predictions on the test data with rf model</a></li>
<li class="chapter" data-level="3.7" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#comparison-with-non-informative-classification"><i class="fa fa-check"></i><b>3.7</b> Comparison with non-informative classification</a></li>
<li class="chapter" data-level="3.8" data-path="Chapter-Modeling.html"><a href="Chapter-Modeling.html#train-data-set-backup-for-tn-specimens-selection"><i class="fa fa-check"></i><b>3.8</b> Train data set backup for TN specimens selection</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Chapter-Perturbation.html"><a href="Chapter-Perturbation.html"><i class="fa fa-check"></i><b>4</b> Perturbation concept</a><ul>
<li class="chapter" data-level="4.1" data-path="Chapter-Perturbation.html"><a href="Chapter-Perturbation.html#objective-3"><i class="fa fa-check"></i><b>4.1</b> Objective</a></li>
<li class="chapter" data-level="4.2" data-path="Chapter-Perturbation.html"><a href="Chapter-Perturbation.html#data-set-and-useful-libraries"><i class="fa fa-check"></i><b>4.2</b> Data set and useful libraries</a></li>
<li class="chapter" data-level="4.3" data-path="Chapter-Perturbation.html"><a href="Chapter-Perturbation.html#perturbation-effect-of-some-elements-on-the-whole"><i class="fa fa-check"></i><b>4.3</b> Perturbation effect of some elements on the whole</a></li>
<li class="chapter" data-level="4.4" data-path="Chapter-Perturbation.html"><a href="Chapter-Perturbation.html#dissimilarity-index-between-compositions"><i class="fa fa-check"></i><b>4.4</b> Dissimilarity index between compositions</a></li>
<li class="chapter" data-level="4.5" data-path="Chapter-Perturbation.html"><a href="Chapter-Perturbation.html#rebalancing-a-misbalanced-sample-by-perturbation"><i class="fa fa-check"></i><b>4.5</b> Rebalancing a misbalanced sample by perturbation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Assessment of the nutritional imbalance status of potato crop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Chapter-Clustering" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Ionome analysis</h1>
<div id="objective-1" class="section level2">
<h2><span class="header-section-number">2.1</span> Objective</h2>
<hr />
<p>This chapter has two objectives. Firstly, I try to assign cultivars to groups based on diagnostic leaves ionomes. Although plant health is a continuous domain rather than a categorical status, yield thresholds are useful for decision-making. Because yield potential varies widely among cultivars, I split experimental data into low- and high-productivity categories using a marketable yield delimiter at the 65^th percentile for each cultivar. Hence, I use high yielders subpopulation (samples which marketable yield is larger than the yield cut-off) to look for patterns (if there are) discriminating groups of similar multivariate compositions (<code>ionomics groups</code>). Then, I check for macroelements that best discriminate cultivars centroids. The discriminant scores are appended to the data frame. In the second stage, I check the effect of clr coordinates on tubers yield in a bayesian linear mixed effect model. The third subsection of the chapter maps the experimental sites locations. At the end, the output data file is called <code>dfml_df.csv</code> i.e., the data frame for machine learning chapter (Chapter <a href="Chapter-Modeling.html#Chapter-Modeling">3</a>).</p>
<hr />
</div>
<div id="useful-libraries-and-custom-functions" class="section level2">
<h2><span class="header-section-number">2.2</span> Useful libraries and custom functions</h2>
<p>A set of packages is needed for data manipulation and visualization like <code>tidyverse</code> presented in previous chapter (Chapter <a href="index.html#Chapter-Data-Processing">1</a>), <a href="https://rdrr.io/cran/mvoutlier/">mvoutlier</a> for multivariate outliers detection, <a href="http://pbil.univ-lyon1.fr/ADE-4">ade4</a> gathers tools for multivariate data analysis (I use it for discriminant analysis), <a href="http://www.sthda.com/english/wiki/wiki.php?id_contents=7940">dbscan</a> a density-based clustering algorithm, which can be used to identify clusters of any shape in data set containing noise and outliers, <a href="https://github.com/kassambara/factoextra">factoextra</a> needed with <code>dbscan</code> for clustering and visualization, <a href="https://www.rdocumentation.org/packages/vegan/versions/2.4-2">vegan</a> to perform principal component analysis, <a href="https://github.com/dkahle/ggmap">ggmap</a> makes it easy to retrieve raster map tiles from online mapping services like Google Maps and Stamen Maps and plot them using the ggplot2 framework, <a href="https://github.com/clauswilke/ggridges">ggridges</a> for geoms to make ridgeline plots using ggplot2, <a href="https://github.com/wilkelab/cowplot">cowplot</a> which can combine multiple ggplot plots to make publication-ready plots, <a href="https://www.r-pkg.org/pkg/extrafont">extrafont</a> for custom fonts for graphs with ggplot2, <a href="https://github.com/slowkow/ggrepel">ggrepel</a> provides text and label geoms for ‘ggplot2’ that help to avoid overlapping text labels, and <a href="https://github.com/paul-buerkner/brms">brms</a> for bayesian regression modeling using <code>Stan</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;mvoutlier&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;ade4&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;dbscan&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;factoextra&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;vegan&quot;</span>)            <span class="co"># PCA</span>
<span class="kw">library</span>(<span class="st">&quot;ggrepel&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;ggmap&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;ggridges&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;cowplot&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;extrafont&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;brms&quot;</span>)  <span class="co"># ou avec rstanarm</span>
<span class="kw">library</span>(<span class="st">&quot;caret&quot;</span>)</code></pre></div>
</div>
<div id="leaves-processed-compositions-data-set" class="section level2">
<h2><span class="header-section-number">2.3</span> Leaves processed compositions data set</h2>
<p>For this chapter, the initial data set is the outcome of the previous chapter (Chapter <a href="index.html#Chapter-Data-Processing">1</a>) <code>leaf_clust_df.csv</code>. Let’s load the data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">leaf_clust_df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;output/leaf_clust_df.csv&quot;</span>)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   NoEssai = col_double(),
##   NoBloc = col_double(),
##   NoTraitement = col_double(),
##   Annee = col_double(),
##   LatDD = col_double(),
##   LonDD = col_double(),
##   AnalyseFoliaireStade = col_character(),
##   Cultivar = col_character(),
##   Maturity5 = col_character(),
##   RendVendable = col_double(),
##   leaf_countNA = col_double(),
##   clr_N = col_double(),
##   clr_P = col_double(),
##   clr_K = col_double(),
##   clr_Ca = col_double(),
##   clr_Mg = col_double(),
##   clr_Fv = col_double()
## )</code></pre>
<p>The next cell maps experimental sites locations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qc_leaf &lt;-<span class="st"> </span><span class="kw">get_stamenmap</span>(<span class="dt">bbox =</span> <span class="kw">c</span>(<span class="dt">left =</span> <span class="op">-</span><span class="dv">76</span>, <span class="dt">right =</span> <span class="op">-</span><span class="dv">68</span>, <span class="dt">bottom =</span> <span class="dv">45</span>, <span class="dt">top =</span> <span class="dv">50</span>), 
                         <span class="dt">zoom =</span> <span class="dv">7</span>, <span class="dt">maptype =</span> <span class="st">&#39;toner-lite&#39;</span>)
<span class="kw">ggmap</span>(qc_leaf) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> leaf_clust_df <span class="op">%&gt;%</span>
<span class="st">               </span><span class="kw">select</span>(LonDD, LatDD) <span class="op">%&gt;%</span>
<span class="st">               </span><span class="kw">unique</span>(), <span class="kw">aes</span>(<span class="dt">x =</span> LonDD, <span class="dt">y =</span> LatDD),
             <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">fill =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="st">&quot;mercator&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Arial&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">12</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:leaf-df-sites-locations"></span>
<img src="2019_Bookdown_files/figure-html/leaf-df-sites-locations-1.png" alt="Location of experimental sites in the Québec potato data set." width="100%" />
<p class="caption">
Figure 2.1: Location of experimental sites in the Québec potato data set.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="st">&quot;images/leaf-df-sites-locations.tiff&quot;</span>, <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">height =</span> <span class="dv">8</span>)</code></pre></div>
</div>
<div id="the-yield-cut-off-low-and-high-yielders-delimiter" class="section level2">
<h2><span class="header-section-number">2.4</span> The yield cut-off, low and high yielders delimiter</h2>
<p>For cluster analysis, I keep only high yielders which I fixed as yield 65% quantile cutter for each cultivar. The <code>cutQ</code> table is used to add the variable <code>yieldClass</code> categorising yield potential to <code>leaf_clust_df</code>. <code>HY</code> and <code>LY</code> stand for high yield and low yield respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cutQ &lt;-<span class="st"> </span>leaf_clust_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Cultivar) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(RendVendable) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise_if</span>(is.numeric, quantile, <span class="dt">probs =</span> <span class="fl">0.65</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">rv_cut =</span> RendVendable)</code></pre></div>
<pre><code>## Adding missing grouping variables: `Cultivar`</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">leaf_clust_df &lt;-<span class="st"> </span>leaf_clust_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(cutQ, <span class="dt">by =</span> <span class="st">&quot;Cultivar&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">yieldClass =</span> forcats<span class="op">::</span><span class="kw">fct_relevel</span>(<span class="kw">ifelse</span>(RendVendable <span class="op">&gt;=</span><span class="st"> </span>rv_cut, <span class="st">&quot;HY&quot;</span>, <span class="st">&quot;LY&quot;</span>), <span class="st">&quot;LY&quot;</span>))</code></pre></div>
<p>For sake of verification, I compute average yield per yieldClass.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_yield &lt;-<span class="st"> </span>leaf_clust_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(yieldClass) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(RendVendable) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise_if</span>(is.numeric, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Adding missing grouping variables: `yieldClass`</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_yield</code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   yieldClass RendVendable
##   &lt;fct&gt;             &lt;dbl&gt;
## 1 LY                 25.8
## 2 HY                 40.5
## 3 &lt;NA&gt;              NaN</code></pre>
<p>So, the average marketable yield is 40.48 Mg <span class="math inline">\(ha^-1\)</span> for high yielders and 24.78 Mg <span class="math inline">\(ha^-1\)</span> for low yielders. In comparison, average potato tuber yields in 2018 in Canada and in Québec were respectively <a href="https://www150.statcan.gc.ca/t1/tbl1/fr/tv.action?pid=3210035801&amp;pickMembers%5B0%5D=1.1">31.21 Mg <span class="math inline">\(ha^-1\)</span></a> and <a href="https://www150.statcan.gc.ca/t1/tbl1/fr/tv.action?pid=3210035801&amp;pickMembers%5B0%5D=1.6">28.75 Mg <span class="math inline">\(ha^-1\)</span></a>.</p>
</div>
<div id="centered-log-ratio-clr-centroids-computation" class="section level2">
<h2><span class="header-section-number">2.5</span> Centered log-ratio (clr) centroids computation</h2>
<p>Compositional data transformation is done in the loaded file. I keep only clr-transformed coordinates for high yielders, at 10 % blossom (AnalyseFoliaireStade = 10% fleur) in the next chunk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hy_df &lt;-<span class="st"> </span>leaf_clust_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">isNA =</span> <span class="kw">apply</span>(<span class="kw">select</span>(., <span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>), Cultivar, Maturity5, RendVendable), <span class="dv">1</span>, anyNA)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">is10pcf =</span> AnalyseFoliaireStade <span class="op">==</span><span class="st"> &quot;10% fleur&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>isNA <span class="op">&amp;</span><span class="st"> </span>is10pcf <span class="op">&amp;</span><span class="st"> </span>yieldClass <span class="op">==</span><span class="st"> &quot;HY&quot;</span> <span class="op">&amp;</span><span class="st"> </span>NoEssai <span class="op">!=</span><span class="st"> &quot;2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(NoEssai, NoBloc, NoTraitement, <span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>), Cultivar, Maturity5, RendVendable) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">droplevels</span>()</code></pre></div>
<p>1334 lines of observations (samples) will be used to find patterns in potato cultivars. I check the number of samples per cultivar in this high yielders data set. Some cultivars have been discarded from the table after the previous filter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">percentage &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">with</span>(hy_df, <span class="kw">prop.table</span>(<span class="kw">table</span>(Cultivar)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>), <span class="dv">2</span>)
distribution &lt;-<span class="st"> </span><span class="kw">with</span>(hy_df, <span class="kw">cbind</span>(<span class="dt">numHY =</span> <span class="kw">table</span>(Cultivar), <span class="dt">percentage =</span> percentage))
distribution &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(distribution, <span class="kw">rownames</span>(distribution)))
<span class="kw">colnames</span>(distribution)[<span class="dv">3</span>] &lt;-<span class="st"> &quot;Cultivar&quot;</span>
distribution<span class="op">$</span>numHY &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(distribution<span class="op">$</span>numHY)) <span class="co"># numHY is the number of samples</span>
distribution<span class="op">$</span>percentage &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(distribution<span class="op">$</span>percentage))
distribution &lt;-<span class="st"> </span>distribution <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(numHY)) <span class="co"># arrange in descending order</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:HY-cultivar-abundance"></span>
<img src="2019_Bookdown_files/figure-html/HY-cultivar-abundance-1.png" alt="High yielders cultivars abundance." width="100%" />
<p class="caption">
Figure 2.2: High yielders cultivars abundance.
</p>
</div>
<p>Some cultivars are well represented, like Superior and Goldrush. Let’s compute number of cultivars and trials in the data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.frame</span>(<span class="dt">numb_cultivars =</span> <span class="kw">n_distinct</span>(hy_df<span class="op">$</span>Cultivar, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
           <span class="dt">numb_trials =</span> <span class="kw">n_distinct</span>(hy_df<span class="op">$</span>NoEssai, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>##   numb_cultivars numb_trials
## 1             47         151</code></pre>
<p>I create a table with cultivars, maturity classes and compute median clr values i.e., clr centroids.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hy_clr &lt;-<span class="st"> </span>hy_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Cultivar, Maturity5) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Cultivar, Maturity5, <span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="kw">list</span>(median))
hy_clr</code></pre></div>
<pre><code>## # A tibble: 47 x 8
## # Groups:   Cultivar [47]
##    Cultivar    Maturity5        clr_N clr_P clr_K clr_Ca clr_Mg clr_Fv
##    &lt;chr&gt;       &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 AC Belmont  early            0.701 -2.02 0.664 -1.11   -1.64   3.47
##  2 AC Chaleur  early            0.696 -1.97 0.349 -1.04   -1.54   3.51
##  3 Amandine    mid-season       0.519 -2.29 0.557 -0.696  -1.62   3.53
##  4 Ambra       mid-season       0.713 -1.98 0.275 -1.08   -1.39   3.46
##  5 Andover     early mid-season 0.872 -2.17 0.738 -0.808  -2.28   3.57
##  6 Aquilon     mid-season       0.783 -1.86 0.387 -0.901  -1.83   3.48
##  7 Argos       late             0.767 -1.77 0.570 -1.28   -1.70   3.43
##  8 Atlantic    mid-season       0.784 -1.87 0.155 -1.09   -1.50   3.56
##  9 Bijou Rouge early            0.942 -1.93 0.563 -1.12   -1.93   3.61
## 10 Carolina    early            0.598 -2.19 0.131 -0.837  -1.34   3.63
## # ... with 37 more rows</code></pre>
<p>I use multivariate outliers detection technique to identify outliers with a quantitle critical value of <code>qcrit = 0.975</code> by cultivar only if cultivars contain at leat 20 rows. If less than 20 rows, all rows are kept. The new data frame <code>hy_df_in</code> will be used for patterns recognition and discriminant analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hy_df_IO &lt;-<span class="st"> </span>hy_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Cultivar) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">do</span>({
    <span class="cf">if</span> (<span class="kw">nrow</span>(.) <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>) {
      IO =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="kw">nrow</span>(.))
    } <span class="cf">else</span> {
      IO =<span class="st"> </span><span class="kw">sign1</span>(.[,<span class="op">-</span><span class="dv">1</span>], <span class="dt">qcrit=</span><span class="fl">0.975</span>)<span class="op">$</span>wfinal01
    }
    <span class="kw">cbind</span>(.,IO)
  }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()

hy_df_in &lt;-<span class="st"> </span>hy_df_IO <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(IO <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>IO) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">droplevels</span>()</code></pre></div>
<p>144 outliers have been discarded.</p>
</div>
<div id="clustering-potato-cultivars-with-ionome" class="section level2">
<h2><span class="header-section-number">2.6</span> Clustering potato cultivars with ionome</h2>
<p>Patterns recognition is done with <a href="http://www.sthda.com/english/wiki/wiki.php?id_contents=7940#algorithm-of-dbscan">dbscan</a> algorithm which can identify dense regions measured by the number of objects close to a given point. As explained by the author, the key idea is that for each point of a cluster, the neighborhood of a given radius has to contain at least a minimum number of points.</p>
<p>I use the high yielders clr centroids of cultivars in a new data frame which is the same as <code>hy_df_in</code> without maturity classes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hy_centroids &lt;-<span class="st"> </span>hy_df_in <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Cultivar) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="kw">list</span>(median)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()</code></pre></div>
<pre><code>## Adding missing grouping variables: `Cultivar`</code></pre>
<p>Two important parameters are required for dbscan: epsilon (“eps”) and minimum points (“MinPts”). The parameter <code>eps</code> defines the radius of neighborhood around a point x. It’s called the <span class="math inline">\(\epsilon\)</span>-neighborhood of x. The parameter <code>MinPts</code> is the minimum number of neighbors within “eps” radius. The optimal value of “eps” parameter can be determined as follow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">5773</span>)
hy_centroids <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">kNNdistplot</span>(., <span class="dt">k =</span> <span class="dv">5</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">0.3</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:eps-optimal"></span>
<img src="2019_Bookdown_files/figure-html/eps-optimal-1.png" alt="The optimal value of “eps” parameter." width="100%" />
<p class="caption">
Figure 2.3: The optimal value of “eps” parameter.
</p>
</div>
<p>The chunk below makes the prdiction of clusters delineated by the dbscan algorithm. Zeros are not a cluster or designates the cluster of outliers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span>hy_centroids <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.matrix</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">dbscan</span>(., <span class="dt">eps =</span> .<span class="dv">3</span>, <span class="dt">minPts =</span> <span class="dv">5</span>)
<span class="kw">predict</span>(res)</code></pre></div>
<pre><code>##  [1] 0 1 0 1 0 1 0 1 1 1 1 1 1 1 1 1 0 1 1 1 1 0 0 0 0 1 1 0 1 1 1 1 1 0 1
## [36] 0 1 1 1 0 1 1 1 0 1 1 1</code></pre>
<p>The result can also be visualized graphically as follow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fviz_cluster</span>(res, hy_centroids <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.matrix</span>(), <span class="dt">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="dt">font.family =</span> <span class="st">&quot;Arial&quot;</span>, <span class="dt">ggtheme =</span> <span class="kw">theme_bw</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>),
        <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>),
        <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:cluster-plot"></span>
<img src="2019_Bookdown_files/figure-html/cluster-plot-1.png" alt="Cluster plot of poato cultivars based on centered log-ratio N P K Mg Ca transformed compositions of diagnostic leaves." width="100%" />
<p class="caption">
Figure 2.4: Cluster plot of poato cultivars based on centered log-ratio N P K Mg Ca transformed compositions of diagnostic leaves.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="st">&quot;images/cluster_plot.tiff&quot;</span>, <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">dpi =</span> <span class="dv">300</span>)</code></pre></div>
<p>Black points are outliers (zeros). As shown on the plot, one cluster means there is no detectable shape between cultivars ionomes as dots are scattered differently. It may not be useful to think of possible structures between potato cultivars based on ionome. Nethertheless, one could extract scores of the first two discriminant axes as numerical variables for cultivars in models, and then check for elements that best discriminate cultivars.</p>
</div>
<div id="axis-reduction" class="section level2">
<h2><span class="header-section-number">2.7</span> Axis reduction</h2>
<p>Leaves composition data are compositionnal data (non-negative and summing to unity) so are multivariate. As argued by <a href="https://www.elsevier.com/books/numerical-ecology/legendre/978-0-444-53868-0">Legendre et Legendre, 2012</a>, it is not possible to draw such a diagram on paper with more than two or eventually three dimensions, however, even though it is a perfectly valid mathematical construct. For the purpose of analysis, I will project the multidimensional scatter diagram onto bivariate graph which axes are known to be of particular interest. The axes of this graph are chosen to represent a large fraction of the variability of the multidimensional <code>N-P-K-Mg-Ca-Fv</code> data matrix, in a space with reduced (i.e. lower) dimensionality relative to the original data set. With the next chunks, I perform a Principle Component Analysis (PCA) ti check biplots, using <code>vegan::rda()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">leaf.pca &lt;-<span class="st"> </span><span class="kw">rda</span>(hy_df_in <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                       </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>)))</code></pre></div>
<p>The rda result object stores samples scores in the <code>sites</code> table and variables loadings in <code>species</code> data table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scores_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">scores</span>(leaf.pca, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))<span class="op">$</span>sites)
loadings_df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">scores</span>(leaf.pca, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))<span class="op">$</span>species)</code></pre></div>
<p>I plot the biplot as result of PCA in separate plots for easy reading.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rda.scores &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> scores_df, <span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">color=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="dv">0</span>, <span class="dt">color=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">0.4</span>, <span class="fl">0.6</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;A&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour=</span><span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">12</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>),
        <span class="dt">text=</span><span class="kw">element_text</span>(<span class="dt">family=</span><span class="st">&quot;Arial&quot;</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">12</span>))

rda.loadings &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> loadings_df) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">xend =</span> PC1, <span class="dt">yend =</span> PC2), <span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="dv">0</span>, 
               <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_label</span>(<span class="kw">aes</span>(<span class="dt">x =</span> PC1, <span class="dt">y =</span> PC2, <span class="dt">label =</span> <span class="kw">rownames</span>(loadings_df)), 
             <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">bg =</span> <span class="st">&quot;grey50&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;PC1&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;PC2&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;B&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">12</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text=</span><span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">12</span>),
        <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Arial&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="dv">12</span>))

<span class="kw">plot_grid</span>(rda.scores, rda.loadings)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:pca-grid-plot"></span>
<img src="2019_Bookdown_files/figure-html/pca-grid-plot-1.png" alt="Grid plot of potato ionome principle component analysis." width="100%" />
<p class="caption">
Figure 2.5: Grid plot of potato ionome principle component analysis.
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="st">&quot;images/pca_bi-plots.tiff&quot;</span>, <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">6</span>, <span class="dt">dpi =</span> <span class="dv">300</span>)</code></pre></div>
<p>The first principle axis or component (<code>PC1</code>) is formed mainly by <code>Mg</code> and <code>K</code>. The second axis (<code>PC2</code>) is driven mainly by <code>P</code> and <code>Ca</code>.</p>
</div>
<div id="do-clrs-affect-potato-tuber-yield" class="section level2">
<h2><span class="header-section-number">2.8</span> Do clrs affect potato tuber yield?</h2>
<p>We will calculate the importance of the clrs effect on tuber yield using <code>varImp()</code> method for object producced by <code>train</code> in machine learning methods, in the next chapter (Chapter <a href="Chapter-Modeling.html#Chapter-Modeling">3</a>).</p>
<p>I select useful columns in a new table named <code>dfml.csv</code>. I conserved only <code>complete cases</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfml &lt;-<span class="st"> </span>leaf_clust_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(NoEssai, NoBloc, NoTraitement,
         <span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>),
         RendVendable, rv_cut, yieldClass,
         AnalyseFoliaireStade,
         Cultivar, Maturity5) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">isNA =</span> <span class="kw">apply</span>(<span class="kw">select</span>(., <span class="kw">starts_with</span>(<span class="st">&quot;clr&quot;</span>), Cultivar, Maturity5, RendVendable), <span class="dv">1</span>, anyNA)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">is10pcf =</span> AnalyseFoliaireStade <span class="op">==</span><span class="st"> &quot;10% fleur&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>isNA <span class="op">&amp;</span><span class="st"> </span>is10pcf <span class="op">&amp;</span><span class="st"> </span>NoEssai <span class="op">!=</span><span class="st"> &quot;2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(AnalyseFoliaireStade, isNA, is10pcf)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">droplevels</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(.))
<span class="kw">write_csv</span>(dfml, <span class="st">&quot;output/dfml.csv&quot;</span>)</code></pre></div>
<p>So, the Machine learning data table contains 3382 samples. I check the data frame to see cultivars abundance. Cultivar <code>Goldrush</code> overcomes the others.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pc &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">with</span>(dfml, <span class="kw">prop.table</span>(<span class="kw">table</span>(Cultivar)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>), <span class="dv">2</span>)
dist &lt;-<span class="st"> </span><span class="kw">with</span>(dfml, <span class="kw">cbind</span>(<span class="dt">freq =</span> <span class="kw">table</span>(Cultivar), <span class="dt">percentage =</span> pc))
dist &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">cbind</span>(dist, <span class="kw">rownames</span>(dist)))
<span class="kw">colnames</span>(dist)[<span class="dv">3</span>] &lt;-<span class="st"> &quot;Cultivar&quot;</span>
dist<span class="op">$</span>freq &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(dist<span class="op">$</span>freq))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ml-cultivar-abundance"></span>
<img src="2019_Bookdown_files/figure-html/ml-cultivar-abundance-1.png" alt="Cultivars abundance in the machine learning data frame." width="100%" />
<p class="caption">
Figure 2.6: Cultivars abundance in the machine learning data frame.
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Chapter-Modeling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["2019_Bookdown.pdf", "2019_Bookdown.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
